<mujoco model="planar_pick_place">
  <compiler angle="radian" coordinate="local"/>
  <option timestep="0.002" gravity="0 0 -9.81" integrator="RK4"/>
  <size njmax="2000" nconmax="200"/>

  <default>
    <joint limited="true" damping="1" armature="0.01"/>
    <geom friction="1 0.005 0.0001" solref="0.02 1" solimp="0.9 0.95 0.001" condim="4"/>
    <motor ctrllimited="true" ctrlrange="-1 1"/>
    <position ctrllimited="true" ctrlrange="-1 1"/>
  </default>

  <asset>
    <material name="mat_floor" rgba="0.85 0.85 0.85 1"/>
    <material name="mat_arm"   rgba="0.2 0.2 0.2 1"/>
    <material name="mat_fing"  rgba="0.1 0.1 0.4 1"/>
    <material name="mat_cube"  rgba="0.9 0.1 0.1 1"/>
    <material name="mat_goal"  rgba="0.1 0.9 0.1 0.25"/>
  </asset>

  <worldbody>
    <!-- Floor -->
    <geom name="floor" type="plane" size="2 2 0.1" material="mat_floor"/>

    <!-- Goal marker (visual only) -->
    <body name="goal" pos="-0.35 0 0.001">
      <geom name="goal_marker" type="cylinder" size="0.06 0.001" material="mat_goal" contype="0" conaffinity="0"/>
      <site name="goal_site" pos="0 0 0.0" size="0.01" rgba="0 1 0 1"/>
    </body>

    <!-- Cube -->
    <body name="cube" pos="0.35 0 0.03">
      <freejoint/>
      <geom name="cube_geom" type="box" size="0.02 0.02 0.02" material="mat_cube" density="800"/>
      <site name="cube_site" pos="0 0 0" size="0.008" rgba="1 0 0 1"/>
    </body>

    <!-- Robot -->
    <body name="base" pos="0 0 0.05">
      <!-- keep base above plane a bit -->
      <geom type="cylinder" size="0.03 0.02" material="mat_arm" density="1000"/>

      <!-- Link 1 -->
      <body name="link1" pos="0 0 0">
        <joint name="j1" type="hinge" axis="0 0 1" range="-3.14 3.14"/>
        <geom name="l1" type="capsule" fromto="0 0 0 0.18 0 0" size="0.015" material="mat_arm" density="600"/>

        <!-- Link 2 -->
        <body name="link2" pos="0.18 0 0">
          <joint name="j2" type="hinge" axis="0 0 1" range="-3.14 3.14"/>
          <geom name="l2" type="capsule" fromto="0 0 0 0.18 0 0" size="0.013" material="mat_arm" density="600"/>

          <!-- Link 3 -->
          <body name="link3" pos="0.18 0 0">
            <joint name="j3" type="hinge" axis="0 0 1" range="-3.14 3.14"/>
            <geom name="l3" type="capsule" fromto="0 0 0 0.14 0 0" size="0.012" material="mat_arm" density="600"/>

            <!-- Link 4 -->
            <body name="link4" pos="0.14 0 0">
              <joint name="j4" type="hinge" axis="0 0 1" range="-3.14 3.14"/>
              <geom name="l4" type="capsule" fromto="0 0 0 0.10 0 0" size="0.011" material="mat_arm" density="600"/>

              <!-- Wrist / gripper base -->
              <body name="wrist" pos="0.10 0 0">
                <geom name="wrist_geom" type="sphere" size="0.014" material="mat_arm" density="600"/>

                <!-- End-effector site -->
                <site name="ee_site" pos="0.02 0 0" size="0.01" rgba="0 0 1 1"/>

                <!-- Single DOF gripper: one slider drives both fingers via equality -->
                <body name="gripper" pos="0.02 0 0">
                  <!-- central mount -->
                  <geom type="box" size="0.01 0.02 0.01" material="mat_arm" density="400"/>

                  <!-- master slider joint: positive opens (moves +y) -->
                  <joint name="grip" type="slide" axis="0 1 0" range="-0.02 0.02" damping="2"/>

                  <!-- Right finger (moves with grip) -->
                  <body name="finger_r" pos="0 0 0">
                    <geom name="finger_r_geom" type="box" pos="0 0.03 0" size="0.007 0.02 0.007" material="mat_fing" density="300"/>
                  </body>

                  <!-- Left finger: mirrored using equality constraint -->
                  <body name="finger_l" pos="0 0 0">
                    <!-- dummy joint that will be constrained to -grip -->
                    <joint name="grip_mirror" type="slide" axis="0 1 0" range="-0.02 0.02" damping="2"/>
                    <geom name="finger_l_geom" type="box" pos="0 -0.03 0" size="0.007 0.02 0.007" material="mat_fing" density="300"/>
                  </body>
                </body>
              </body>
            </body>
          </body>
        </body>
      </body>
    </body>
  </worldbody>

  <!-- Mirror the left finger joint to be the negative of grip -->
  <equality>
    <joint name="mirror_grip" joint1="grip" joint2="grip_mirror" polycoef="0 -1 0 0 0"/>
  </equality>

  <actuator>
    <!-- Simple torque motors on arm joints -->
    <position name="a1" joint="j1" kp="60" ctrlrange="-3.14 3.14"/>
    <position name="a2" joint="j2" kp="60" ctrlrange="-3.14 3.14"/>
    <position name="a3" joint="j3" kp="50" ctrlrange="-3.14 3.14"/>
    <position name="a4" joint="j4" kp="40" ctrlrange="-3.14 3.14"/>

    <!-- Position actuator for gripper (stable) -->
    <position name="grip_pos" joint="grip" kp="200" ctrlrange="-0.02 0.02"/>
  </actuator>
</mujoco>